# =============================================================================
# Configuration: Secrets + ConfigMap
# =============================================================================
# Secrets:    Store sensitive data (passwords, keys) - base64 encoded
# ConfigMap:  Store non-sensitive config (URLs, feature flags) - plain text
#
# Why separate from Deployments?
#   - Change config without rebuilding images
#   - Reuse across multiple deployments
#   - Secrets can have restricted access (RBAC)
#
# Usage:
#   kubectl apply -f config.yaml
#   kubectl get secrets -n trading
#   kubectl get configmaps -n trading
# =============================================================================

# -----------------------------------------------------------------------------
# Secret: PostgreSQL Credentials
# -----------------------------------------------------------------------------
# Note: In production, use external secret managers (AWS Secrets Manager, Vault)
# For learning, we encode values with: echo -n "value" | base64

apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
  namespace: trading            # Must match our namespace
type: Opaque                    # Generic secret type (vs docker-registry, tls, etc.)
data:
  # Base64 encoded values (NOT encryption, just encoding)
  # echo -n "trading" | base64  →  dHJhZGluZw==
  database: dHJhZGluZw==        # "trading"
  username: dHJhZGluZw==        # "trading"
  password: dHJhZGluZw==        # "trading"

---
# -----------------------------------------------------------------------------
# Secret: RabbitMQ Credentials
# -----------------------------------------------------------------------------
apiVersion: v1
kind: Secret
metadata:
  name: rabbitmq-secret
  namespace: trading
type: Opaque
data:
  # echo -n "guest" | base64  →  Z3Vlc3Q=
  username: Z3Vlc3Q=            # "guest"
  password: Z3Vlc3Q=            # "guest"

---
# -----------------------------------------------------------------------------
# ConfigMap: Spring Application Config
# -----------------------------------------------------------------------------
# Non-sensitive configuration shared across services

apiVersion: v1
kind: ConfigMap
metadata:
  name: spring-config
  namespace: trading
data:
  # These become environment variables in your pods
  SPRING_PROFILES_ACTIVE: "docker"

  # Service discovery: In Kubernetes, services are accessible by their name
  # "postgres" resolves to the postgres Service's ClusterIP
  POSTGRES_HOST: "postgres"
  POSTGRES_PORT: "5432"
  RABBITMQ_HOST: "rabbitmq"
  RABBITMQ_PORT: "5672"
